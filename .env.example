# =============================================================================
# Healthcare ML Platform - Environment Variables
# =============================================================================
#
# Copy this file to .env and fill in your actual values:
#   cp .env.example .env
#
# IMPORTANT: Never commit .env to version control!
# =============================================================================

# =============================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# =============================================================================

# PostgreSQL connection string
# Format: postgresql://username:password@host:port/database
DATABASE_URL=postgresql://postgres:password@localhost:5432/mimic_iv

# Alternative: Individual components (for tools that don't support full URL)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=mimic_iv
DB_USER=postgres
DB_PASSWORD=password

# Connection pool settings
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30

# =============================================================================
# REDIS CONFIGURATION (Caching & Session Management)
# =============================================================================

# Redis connection string
REDIS_URL=redis://localhost:6379

# Alternative: Individual components
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
# REDIS_PASSWORD=your_redis_password  # Uncomment if Redis requires auth

# Cache settings
CACHE_TTL_SECONDS=3600  # 1 hour
CACHE_MAX_SIZE_MB=1024  # 1GB

# =============================================================================
# MLFLOW CONFIGURATION (Model Registry & Experiment Tracking)
# =============================================================================

# MLflow tracking server URL
MLFLOW_TRACKING_URI=http://localhost:5000

# MLflow artifact storage (local or S3)
MLFLOW_ARTIFACT_LOCATION=./mlruns

# MLflow authentication (optional)
# MLFLOW_TRACKING_USERNAME=admin
# MLFLOW_TRACKING_PASSWORD=password

# Model serving settings
MODEL_CACHE_SIZE=5  # Number of models to keep in memory
MODEL_RELOAD_INTERVAL_SECONDS=300  # Check for new versions every 5 minutes

# =============================================================================
# FASTAPI CONFIGURATION (Backend API)
# =============================================================================

# API server settings
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4  # Number of Uvicorn workers

# API URL (for external access)
API_URL=http://localhost:8000

# CORS settings (comma-separated origins)
CORS_ORIGINS=http://localhost:8501,http://localhost:3000

# API security
API_SECRET_KEY=change-this-to-a-secure-random-string
API_RATE_LIMIT=100  # Requests per minute per IP

# Logging
API_LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL

# =============================================================================
# STREAMLIT CONFIGURATION (Frontend UI)
# =============================================================================

# Streamlit server settings
STREAMLIT_SERVER_PORT=8501
STREAMLIT_SERVER_ADDRESS=localhost

# Streamlit theme
STREAMLIT_THEME_PRIMARY_COLOR=#FF6B6B
STREAMLIT_THEME_BACKGROUND_COLOR=#FFFFFF
STREAMLIT_THEME_SECONDARY_BACKGROUND_COLOR=#F0F2F6

# =============================================================================
# AIRFLOW CONFIGURATION (Workflow Orchestration)
# =============================================================================

# Airflow core settings
AIRFLOW_HOME=/opt/airflow
AIRFLOW__CORE__EXECUTOR=LocalExecutor
AIRFLOW__CORE__SQL_ALCHEMY_CONN=postgresql://airflow:airflow@localhost:5432/airflow
AIRFLOW__CORE__LOAD_EXAMPLES=False

# Airflow webserver
AIRFLOW__WEBSERVER__WEB_SERVER_PORT=8080
AIRFLOW__WEBSERVER__SECRET_KEY=change-this-to-a-secure-random-string

# Airflow admin credentials
AIRFLOW_USERNAME=admin
AIRFLOW_PASSWORD=admin

# Airflow logging
AIRFLOW__LOGGING__BASE_LOG_FOLDER=/opt/airflow/logs
AIRFLOW__LOGGING__LOGGING_LEVEL=INFO

# =============================================================================
# DBT CONFIGURATION (Data Transformation)
# =============================================================================

# dbt project directory
DBT_PROJECT_DIR=./dbt_project

# dbt profiles directory (where profiles.yml is located)
DBT_PROFILES_DIR=./dbt_project

# dbt target (development or production)
DBT_TARGET=dev

# =============================================================================
# KAGGLEHUB CONFIGURATION (Data Download)
# =============================================================================

# Kaggle credentials (required for downloading MIMIC-IV dataset)
# Get your API token from: https://www.kaggle.com/settings
# Place it in ~/.kaggle/kaggle.json OR set these environment variables:

# KAGGLE_USERNAME=your_kaggle_username
# KAGGLE_KEY=your_kaggle_api_key

# Alternative: Path to kaggle.json
# KAGGLE_CONFIG_DIR=~/.kaggle

# Dataset to download
KAGGLE_DATASET=akshaybe/updated-mimic-iv
KAGGLE_DATASET_PATH=./data/mimic-iv

# =============================================================================
# AGENT SYSTEM CONFIGURATION (CrewAI)
# =============================================================================

# Agent execution settings
AGENT_MAX_RETRIES=3
AGENT_TIMEOUT_SECONDS=300  # 5 minutes
AGENT_LOG_LEVEL=INFO

# Agent hooks configuration
AGENT_HOOKS_ENABLED=true
AGENT_HOOKS_CONFIG_PATH=./agents/config/hooks.yaml

# Orchestrator settings
ORCHESTRATOR_PARALLEL_CREWS=2  # Number of crews to run in parallel
ORCHESTRATOR_CHECKPOINT_DIR=./checkpoints

# =============================================================================
# MONITORING & OBSERVABILITY
# =============================================================================

# Logging configuration
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text
LOG_FILE_PATH=./logs/app.log
LOG_FILE_MAX_SIZE_MB=100
LOG_FILE_BACKUP_COUNT=5

# Prometheus metrics (if enabled)
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# Sentry error tracking (optional)
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
# SENTRY_ENVIRONMENT=development
# SENTRY_TRACES_SAMPLE_RATE=0.1

# =============================================================================
# ALERTING CONFIGURATION
# =============================================================================

# Slack alerts (optional)
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
# SLACK_CHANNEL=#ml-alerts

# Email alerts (optional)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USERNAME=your-email@gmail.com
# SMTP_PASSWORD=your-app-password
# ALERT_EMAIL_FROM=alerts@yourcompany.com
# ALERT_EMAIL_TO=oncall@yourcompany.com

# PagerDuty alerts (optional)
# PAGERDUTY_API_KEY=your-pagerduty-api-key
# PAGERDUTY_SERVICE_ID=your-service-id

# =============================================================================
# MODEL CONFIGURATION
# =============================================================================

# Model names
SEPSIS_MODEL_NAME=sepsis_lightgbm_v1
MORTALITY_MODEL_NAME=mortality_lightgbm_v1

# Model performance thresholds
SEPSIS_AUROC_THRESHOLD=0.85
MORTALITY_AUROC_THRESHOLD=0.80

# Feature completeness threshold
FEATURE_COMPLETENESS_THRESHOLD=0.70  # 70% of features must be non-null

# =============================================================================
# DATA QUALITY CONFIGURATION
# =============================================================================

# Data quality thresholds
DATA_QUALITY_THRESHOLD=0.90  # 90% quality score required

# Great Expectations configuration (optional)
# GE_CONFIG_DIR=./great_expectations
# GE_CHECKPOINT_NAME=data_quality_checkpoint

# =============================================================================
# FEATURE ENGINEERING CONFIGURATION
# =============================================================================

# Feature extraction settings
FEATURE_EXTRACTION_BATCH_SIZE=1000
FEATURE_EXTRACTION_PARALLEL_WORKERS=4

# SOFA score calculation settings
SOFA_REFRESH_INTERVAL_HOURS=24  # Refresh materialized view every 24h

# =============================================================================
# SECURITY & AUTHENTICATION
# =============================================================================

# JWT settings (for API authentication - future)
# JWT_SECRET_KEY=your-jwt-secret-key
# JWT_ALGORITHM=HS256
# JWT_EXPIRATION_MINUTES=30

# API keys (for external integrations - future)
# EXTERNAL_API_KEY=your-external-api-key

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Batch processing settings
BATCH_SIZE_INGESTION=10000  # Rows per batch for data ingestion
BATCH_SIZE_PREDICTION=100  # Predictions per batch

# Thread/worker settings
WORKER_THREADS=4
WORKER_PROCESSES=2

# Memory limits (MB)
MEMORY_LIMIT_PER_WORKER_MB=2048

# =============================================================================
# DEVELOPMENT & TESTING
# =============================================================================

# Environment mode
ENVIRONMENT=development  # development, staging, production

# Debug mode
DEBUG=true

# Testing
TESTING=false
TEST_DATABASE_URL=postgresql://postgres:password@localhost:5432/mimic_iv_test

# =============================================================================
# DOCKER COMPOSE OVERRIDES (Optional)
# =============================================================================

# Override container ports if needed
# POSTGRES_PORT=5433
# REDIS_PORT=6380
# MLFLOW_PORT=5001
# API_PORT=8001
# STREAMLIT_PORT=8502
# AIRFLOW_PORT=8081

# =============================================================================
# ADDITIONAL SETTINGS
# =============================================================================

# Timezone
TZ=UTC

# Language
LANG=en_US.UTF-8

# Python settings
PYTHONUNBUFFERED=1
PYTHONDONTWRITEBYTECODE=1

# =============================================================================
# NOTES
# =============================================================================
#
# 1. Required Variables (Minimum):
#    - DATABASE_URL
#    - REDIS_URL
#    - MLFLOW_TRACKING_URI
#    - API_URL
#    - KAGGLE credentials (for data download)
#
# 2. Recommended Variables:
#    - All logging settings
#    - Agent system settings
#    - Model configuration
#
# 3. Optional Variables:
#    - Monitoring (Prometheus, Sentry)
#    - Alerting (Slack, Email, PagerDuty)
#    - Security (JWT)
#
# 4. Security Best Practices:
#    - Use strong, unique passwords
#    - Rotate secrets regularly
#    - Never commit .env to version control
#    - Use environment-specific .env files
#
# 5. For Production:
#    - Set ENVIRONMENT=production
#    - Set DEBUG=false
#    - Use strong API_SECRET_KEY
#    - Enable monitoring and alerting
#    - Use secure passwords for all services
#
# =============================================================================
